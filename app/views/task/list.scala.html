@import java.text.SimpleDateFormat
@(tasks: Seq[models.task.Task])(implicit request: Request[AnyContent])

@main("Your tasks") {
    @nav(showMenu = true)
    <div class="container">
        <div class="row">
        @for(task <- tasks) {
            <div class="card mt-3" style="width: 100%">
                <div class="card-header">
                    <span class="w-100">@{task.title}</span>
                    <button type="button" class="close" data-dismiss="alert" aria-label="Close"
                        onClick="location.href='@controllers.task.routes.EditTaskController.editTaskForm(task.id.value)'">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="card-body">
                    <p class="card-text border-primary">@{task.description}</p>
                    <div class="dropdown float-right" role="state" aria-label="state" id="stateSelection" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        <button id="state-btn-task-@task.id.value" type="button" class="btn btn-secondary dropdown-toggle">@{task.state}</button>
                        <div class="dropdown-menu" aria-labelledby="stateSelection">
                            <a class="dropdown-item" onClick="updateState(@task.id.value, 'InComplete');" href="#">InComplete</a>
                            <a class="dropdown-item" onClick="updateState(@task.id.value, 'InProgress');" href="#">InProgress</a>
                            <a class="dropdown-item" onClick="updateState(@task.id.value, 'Complete');" href="#">Complete</a>
                        </div>
                    </div>
                </div>
                <div class="card-footer text-muted text-right">@{
                    task.deadline.map { date =>
                      s"Deadline: ${new SimpleDateFormat("yyyy-mm-dd'T'HH:mm").format(date)}"
                    }.getOrElse {
                        "No Deadline"
                    }
                }</div>
            </div>
        }
        </div>
    </div>
    <script>
        var updateState = function(id, state) {
            $('#state-btn-task-'+id).text(state);
            $('#state-btn-task-'+id).val(state);
        };
    </script>
}